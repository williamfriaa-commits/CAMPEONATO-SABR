<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Vetos de Mapas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #000;
        color: #fff;
    }

    .container {
        max-width: 900px;
        margin: auto;
        padding: 20px;
        text-align: center;
    }

    h1 { font-size: 28px; margin-bottom: 10px; }
    h2 { color: #0f0; }

    .map-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-top: 20px;
    }

    .map {
        background: #111;
        padding: 10px;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.2s;
        border: 2px solid #333;
    }

    .map img {
        width: 100%;
        border-radius: 6px;
    }

    .map.disabled {
        opacity: 0.3;
        pointer-events: none;
    }

    /* MODAL */
    #modalConfirm {
        display: none;
        position: fixed;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.85);
        justify-content: center;
        align-items: center;
        text-align: center;
    }

    #modalBox {
        background: #111;
        padding: 20px;
        width: 90%;
        max-width: 350px;
        border-radius: 12px;
        border: 2px solid #0f0;
    }

    #modalBox img {
        width: 100%;
        border-radius: 10px;
    }

    #modalBox button {
        background: #0f0;
        padding: 10px 20px;
        border: none;
        margin-top: 15px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
    }

    #waiting {
        display: none;
        margin-top: 15px;
        font-size: 16px;
        color: #0f0;
    }
</style>
</head>
<body>

<div class="container">
    <h1>Veto de Mapas</h1>
    <h2 id="modeText">Modo: MD1</h2>
    <h3 id="turnText">Aguardando turno...</h3>

    <div class="map-grid" id="mapGrid"></div>

    <div id="waiting">‚è≥ Aguardando o outro jogador confirmar...</div>
</div>

<!-- MODAL -->
<div id="modalConfirm">
    <div id="modalBox">
        <h3 id="modalTitle">Mapa Selecionado</h3>
        <img id="modalImg" src="">
        <p id="modalName"></p>
        <button onclick="confirmSelection()">OK</button>
    </div>
</div>

<script>
/* ------------------------------------------
   üî• CONFIG FIREBASE
------------------------------------------- */
const firebaseConfig = {
    apiKey: "AIzaSyXXXX",
    authDomain: "xxxx.firebaseapp.com",
    databaseURL: "https://xxxx-default-rtdb.firebaseio.com",
    projectId: "xxxx",
    storageBucket: "xxxx.appspot.com",
    messagingSenderId: "xxxx",
    appId: "xxxx"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ------------------------------------------
   üî• LISTA DE MAPAS
------------------------------------------- */
const maps = [
    { name: "Dust2", img: "https://i.imgur.com/tAeGQob.jpeg" },
    { name: "Mirage", img: "https://i.imgur.com/ljUNkqs.jpeg" },
    { name: "Nuke", img: "https://i.imgur.com/y6kTKoJ.jpeg" },
    { name: "Inferno", img: "https://i.imgur.com/x7ZuSxF.jpeg" },
    { name: "Train", img: "https://i.imgur.com/Nfz6I7C.jpeg" }
];

/* ------------------------------------------
   üî• VARI√ÅVEIS
------------------------------------------- */
let player = null;
let currentTurn = 1;
let totalPicks = 0;
let mdMode = "MD5"; // j√° trava no MD5 como voc√™ quer
let selectedMapTemp = null;

/* ------------------------------------------
   üî• ENTRAR NA SALA
------------------------------------------- */
db.ref("vetos/playerCount").once("value", snap => {
    let count = snap.val() || 0;

    player = count >= 1 ? 2 : 1;
    db.ref("vetos/playerCount").set(player);

    document.getElementById("turnText").innerHTML =
        `Voc√™ √© o Jogador ${player}`;
});

/* ------------------------------------------
   üî• DESENHAR MAPAS
------------------------------------------- */
function loadMaps() {
    const grid = document.getElementById("mapGrid");
    grid.innerHTML = "";

    maps.forEach((m, index) => {
        const div = document.createElement("div");
        div.className = "map";
        div.innerHTML = `
            <img src="${m.img}">
            <p>${m.name}</p>
        `;
        div.onclick = () => pickMap(index);

        grid.appendChild(div);
    });
}
loadMaps();

/* ------------------------------------------
   üî• SELECIONAR MAPA (MOSTRA MODAL)
------------------------------------------- */
function pickMap(i) {
    if (player !== currentTurn) return;

    selectedMapTemp = i;

    document.getElementById("modalImg").src = maps[i].img;
    document.getElementById("modalName").innerHTML = maps[i].name;

    document.getElementById("modalConfirm").style.display = "flex";
}

/* ------------------------------------------
   üî• JOGADOR CLICOU OK
------------------------------------------- */
function confirmSelection() {
    db.ref("vetos/selection").set({
        player: player,
        map: selectedMapTemp,
        ready: true
    });

    document.getElementById("modalConfirm").style.display = "none";
    document.getElementById("waiting").style.display = "block";
}

/* ------------------------------------------
   üî• OUVIR SE AMBOS CONFIRMARAM
------------------------------------------- */
db.ref("vetos/selection").on("value", snap => {
    const data = snap.val();
    if (!data) return;

    if (data.ready && data.player !== player) {
        document.getElementById("waiting").style.display = "block";
    }

    db.ref("vetos/readyCheck").once("value", r => {
        let ready = r.val() || 0;
        ready++;

        db.ref("vetos/readyCheck").set(ready);

        if (ready >= 2) {
            finalizeTurn(data.map);
        }
    });
});

/* ------------------------------------------
   üî• FINALIZAR TURNO
------------------------------------------- */
function finalizeTurn(mapIndex) {
    document.getElementById("waiting").style.display = "none";

    let allMaps = document.querySelectorAll(".map");
    allMaps[mapIndex].classList.add("disabled");

    totalPicks++;
    currentTurn = currentTurn === 1 ? 2 : 1;

    document.getElementById("turnText").innerHTML =
        `Agora √© a vez do Jogador ${currentTurn}`;

    db.ref("vetos/readyCheck").set(0);
    db.ref("vetos/selection").set(null);
}
</script>
</body>
</html>
